# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å Firebase –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ - –ò—Ç–æ–≥–∏

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ –£–¥–∞–ª–µ–Ω–æ (Firebase)

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
   - `firebase.json` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –ø—Ä–æ–µ–∫—Ç–∞
   - `firestore.indexes.json` - –∏–Ω–¥–µ–∫—Å—ã Firestore
   - `rules.txt` - –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firestore
   - `.firebaserc` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ Firebase
   - `functions/` - –ø–∞–ø–∫–∞ —Å Firebase Functions

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - `DEPLOY_RULES.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Firebase
   - `IMPROVEMENTS.md` - —É–ª—É—á—à–µ–Ω–∏—è Firebase

### ‚úÖ –°–æ–∑–¥–∞–Ω–æ (–Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ)

1. **Backend API:**
   - `function/index.js` - Express.js —Å–µ—Ä–≤–µ—Ä
   - `function/package.json` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
   - `function/database.sql` - —Å—Ö–µ–º–∞ PostgreSQL
   - `function/env.example` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - `function/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è backend

2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
   - `yandex-cloud-config.json` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞
   - `YANDEX_CLOUD_SETUP.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
   - `README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - `MIGRATION_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Frontend (index.html)

#### –£–¥–∞–ª–µ–Ω–æ:
- Firebase SDK –∏–º–ø–æ—Ä—Ç—ã
- Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Firebase –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`signInAnonymously`, `signInWithCustomToken`)
- Firestore –æ–ø–µ—Ä–∞—Ü–∏–∏ (`getDoc`, `setDoc`, `onSnapshot`)
- Firebase-–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- REST API –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `fetch()`
- –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API:
  - `initYandexCloud()`
  - `authenticateUser()`
  - `loadUsers()`
  - `loadPendingUsers()`
  - `loadMonthData()`
  - `saveData()` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
  - `createAccessRequestIfNeeded()` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

### Backend API

#### –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π REST API:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- `GET /users/:telegramId` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /users` - –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `POST /users` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `DELETE /users/:telegramId` - —É–¥–∞–ª–µ–Ω–∏–µ

**–ö–∞–ª–µ–Ω–¥–∞—Ä—å:**
- `GET /months/:monthId` - –¥–∞–Ω–Ω—ã–µ –º–µ—Å—è—Ü–∞
- `PUT /months/:monthId` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ó–∞—è–≤–∫–∏:**
- `GET /pending-users` - –≤—Å–µ –∑–∞—è–≤–∫–∏
- `POST /pending-users` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `DELETE /pending-users/:telegramId` - —É–¥–∞–ª–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞:**
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PostgreSQL:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE TABLE users (
    telegram_id VARCHAR(20) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL DEFAULT 'guest',
    active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ó–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø
CREATE TABLE pending_users (
    telegram_id VARCHAR(20) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    username VARCHAR(50),
    requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –î–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
CREATE TABLE months (
    id VARCHAR(20) PRIMARY KEY,
    duties JSONB DEFAULT '{}',
    tech_duties JSONB DEFAULT '{}',
    general_schedule JSONB DEFAULT '{}',
    colors JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞–º–µ–Ω–µ–Ω–æ:
- **Firebase Auth** ‚Üí **API –∫–ª—é—á–∏**
- **Firestore Rules** ‚Üí **Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏**
- **Custom Claims** ‚Üí **–†–æ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### –ù–æ–≤—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- API –∫–ª—é—á–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ API
- SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ë—ã–ª–æ (Firebase):
```
Frontend ‚Üí Firebase Auth ‚Üí Firestore Rules ‚Üí Firestore
```

### –°—Ç–∞–ª–æ (–Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ):
```
Frontend ‚Üí API Key ‚Üí Cloud Functions ‚Üí PostgreSQL
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### Firebase (–±—ã–ª–æ):
- **Firebase Auth**: 10,000 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **Firestore**: 1 –ì–ë —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, 50,000 –æ–ø–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å
- **Functions**: 125,000 –≤—ã–∑–æ–≤–æ–≤/–º–µ—Å—è—Ü

### –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ (—Å—Ç–∞–ª–æ):
- **Cloud Functions**: 1,000,000 –≤—ã–∑–æ–≤–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **PostgreSQL**: 2 –ì–ë —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **Object Storage**: 10 –ì–ë —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –†–µ—à–µ–Ω–æ:
1. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤ –†–æ—Å—Å–∏–∏** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ VPN
2. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–∞–º** - 152-–§–ó
3. **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
4. **–î–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä—ã** - –≤ –†–æ—Å—Å–∏–∏
5. **–°—Ç–æ–∏–º–æ—Å—Ç—å** - –±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ:
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - PostgreSQL –±—ã—Å—Ç—Ä–µ–µ Firestore
2. **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ API
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - serverless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞
- –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [cloud.yandex.ru](https://cloud.yandex.ru)
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `YANDEX_CLOUD_SETUP.md`

### 2. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ backend
```bash
cd function
npm install
npm run deploy
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä PostgreSQL
- –í—ã–ø–æ–ª–Ω–∏—Ç—å `database.sql`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ frontend
- –ó–∞–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `index.html`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 5. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ Firebase
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è

## üìù –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

- ‚úÖ **Frontend** - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ
- ‚úÖ **Backend API** - —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Å—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚è≥ **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞
- ‚è≥ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–µ. –í—Å–µ Firebase –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω—ã, —Å–æ–∑–¥–∞–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π REST API –Ω–∞ Node.js —Å PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –†–æ—Å—Å–∏–∏ –±–µ–∑ VPN –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É.

---

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**: 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–µ 